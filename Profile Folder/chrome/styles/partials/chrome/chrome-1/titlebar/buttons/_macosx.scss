& {
    //Give the tabs/Incognito/pfp the appropriate offset
	#private-browsing-indicator-with-label {
        order: 999 !important; // Force to right
        transform: scaleX(-1);
    }
    .titlebar-spacer[type="post-tabs"] {
        order: 1000 !important; // Force to right of Incognito
    }
    &:not([privatebrowsingmode="temporary"]) {
        #TabsToolbar-customization-target {
            margin-inline-end: var(--tab-distance-from-toolbar-edge);
        }
    }
    // Incognito can't use this^ spacing, so we need to set it separately for Incognito
    &[privatebrowsingmode="temporary"] {
        #private-browsing-indicator-with-label {
            margin-inline-end: var(--tab-distance-from-toolbar-edge);
        }
    }
    #fxa-toolbar-menu-button,
    .private-browsing-indicator-icon {
        margin-inline-start: var(--tab-distance-from-pfp) !important;
        margin-inline-end: 1px !important;
    }

    //Show the Google logo after the buttons if enabled
    &[gkbranding="chrome"][geckium-chrflag-other-platforms-watermark="true"] {
        .titlebar-buttonbox-container::after {
            content: url("chrome://userchrome/content/assets/img/chrome-1/titlebar/windows/google.png");
            margin-block-start: 2px;
            margin-inline-start: 7px;
        }
        &[sizemode="maximized"],
        &[sizemode="fullscreen"] {
            .titlebar-buttonbox-container::after {
                content: unset !important;
            }
        }
    }

    //NOTE: macOS and Mac OS X BLOCK native titlebars

    //Titlebar button box (force onto left side)
    .titlebar-buttonbox-container {
        order: -1 !important;
        align-items: unset !important;
        margin-inline-start: 8px; // left margin
        margin-block-start: 6px; // top margin
    }
    //Linux quirk: Counteract exclusive menubar padding
    @media (-moz-platform: linux) {
        #toolbar-menubar .titlebar-buttonbox-container {
            margin-block-start: 5px;
        }
    }

    .titlebar-buttonbox {
        align-items: unset !important;
        gap: 7px;
    }
    .titlebar-button {
        &::before { //macOS WILL NOT have its buttons filled
            content: unset !important;
        }
    }

    //Shared titlebar button code
    .titlebar-button {
        height: 12px;
        width: 12px;
        border-radius: 100% !important;
        background-clip: padding-box !important;
        transition: none; //Mac OS X lacked an animation for titlebar button-hover
        display: flex !important;

        background-image: url(chrome://userchrome/content/assets/img/chrome-21/titlebar/macosx/tlight.svg) !important;
        box-shadow: inset 0 0.1px 0.75px 0.75px rgba(0,0,0,0.5),
                    0 1px rgba(255, 255, 255, 0.38);
        list-style-image: unset !important;

        &:not([disabled]):active {
            &::after {
                content: "";
                left: 0;
				top: 0;
				right: 0;
				bottom: 0;
				position: absolute;
                border-radius: 100%;
                background: rgba(0,0,0,0.22);
            }
        }
        image {
            -moz-context-properties: fill, fill-opacity !important;
        }
    }

    //Close button
    .titlebar-close:not([disabled]) {
        order: 0 !important;

        background-color: #EA554E !important;
        fill: #CF0000 !important;

        &:hover,
        &:active {
            list-style-image: url(chrome://userchrome/content/assets/img/chrome-21/titlebar/macosx/close.svg) !important;
        }
    }

    //Minimise button
    .titlebar-min:not([disabled]) {
        order: 1 !important;

        background-color: #F2BA5F !important;
        fill: #C77B01 !important;

        &:hover,
        &:active {
            list-style-image: url(chrome://userchrome/content/assets/img/chrome-21/titlebar/macosx/min.svg) !important;
        }
    }

    //Maximise and Restore buttons
    &[sizemode="maximized"],
    &[sizemode="fullscreen"] {
        .titlebar-max {
            display: none !important;
        }
    }
    &:not([sizemode="maximized"]):not([sizemode="fullscreen"]) {
        .titlebar-restore {
            display: none !important;
        }
    }
    .titlebar-max:not([disabled]),
    .titlebar-restore:not([disabled]) {
        order: 2 !important;
        &:hover,
        &:active {
            list-style-image: url(chrome://userchrome/content/assets/img/chrome-21/titlebar/macosx/zoom.svg) !important;
        }

        background-color: #97CF72 !important;
        fill: #529B0D !important;
    }

    // Graphite
    &[gkmacgraphite="true"] {
        .titlebar-close:not([disabled]),
        .titlebar-min:not([disabled]),
        .titlebar-max:not([disabled]),
        .titlebar-restore:not([disabled]) {
            background-color: #A2B3C0 !important;
            fill: #5E6C7A !important;
        }
    }
    // Inactive / Disabled
    &:-moz-window-inactive .titlebar-button:not(:hover, :active),
    .titlebar-button[disabled] {
        background-color: #C9C9C9 !important;
    }
    @media (prefers-color-scheme: dark) {
        &:-moz-window-inactive .titlebar-button:not(:hover, :active),
        .titlebar-button[disabled] {
            background-color: #989898 !important;
        }
    }
}